{"version":3,"sources":["../../../../src/commands/doctor/healthchecks/iosDeploy.ts"],"names":["label","installationWithYarn","installationWithNpm","identifyInstallationCommand","packageManager","PACKAGE_MANAGERS","YARN","NPM","undefined","installLibrary","installationCommand","packageManagerToUse","loader","start","installationCommandArgs","split","splice","succeed","error","healthcheck","command","isRequired","description","getDiagnostics","needsToBeFixed","runAutomaticFix","logManualInstallation","stop","promptQuestion","chalk","bold","reset","installWithYarn","title","value","installWithNpm","skipInstallation","chosenPackageManager","type","name","message","choices","fail","url","shouldInstallWithYarn","toLowerCase"],"mappings":"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","sourcesContent":["import execa from 'execa';\nimport chalk from 'chalk';\nimport prompts from 'prompts';\nimport {isSoftwareNotInstalled, PACKAGE_MANAGERS} from '../checkInstallation';\nimport {packageManager} from './packageManagers';\nimport {logError, removeMessage} from './common';\nimport {HealthCheckInterface} from '@react-native-community/cli-types';\nimport {Ora} from 'ora';\n\nconst label = 'ios-deploy';\n\nconst installationWithYarn = 'yarn global add ios-deploy';\nconst installationWithNpm = 'npm install ios-deploy --global';\n\nconst identifyInstallationCommand = () => {\n  if (packageManager === PACKAGE_MANAGERS.YARN) {\n    return installationWithYarn;\n  }\n\n  if (packageManager === PACKAGE_MANAGERS.NPM) {\n    return installationWithNpm;\n  }\n\n  return undefined;\n};\n\nconst installLibrary = async ({\n  installationCommand,\n  packageManagerToUse,\n  loader,\n}: {\n  installationCommand: string;\n  packageManagerToUse: 'yarn' | 'npm';\n  loader: Ora;\n}) => {\n  try {\n    loader.start(`${label} (installing with ${packageManagerToUse})`);\n\n    const installationCommandArgs = installationCommand.split(' ');\n\n    await execa(installationCommandArgs[0], installationCommandArgs.splice(1));\n\n    loader.succeed(`${label} (installed with ${packageManagerToUse})`);\n  } catch (error) {\n    logError({\n      healthcheck: label,\n      loader,\n      error,\n      command: installationCommand,\n    });\n  }\n};\n\nexport default {\n  label,\n  isRequired: false,\n  description:\n    'Required for installing your app on a physical device with the CLI',\n  getDiagnostics: async () => ({\n    needsToBeFixed: await isSoftwareNotInstalled('ios-deploy'),\n  }),\n  runAutomaticFix: async ({loader, logManualInstallation}) => {\n    loader.stop();\n\n    const installationCommand = identifyInstallationCommand();\n\n    // This means that we couldn't \"guess\" the package manager\n    if (installationCommand === undefined) {\n      const promptQuestion = `ios-deploy needs to be installed either by ${chalk.bold(\n        'yarn',\n      )} ${chalk.reset('or')} ${chalk.bold(\n        'npm',\n      )} ${chalk.reset()}, which one do you want to use?`;\n      const installWithYarn = {title: 'yarn', value: 'yarn'};\n      const installWithNpm = {title: 'npm', value: 'npm'};\n      const skipInstallation = {\n        title: 'Skip installation',\n        value: 'skip',\n      };\n\n      const {chosenPackageManager} = await prompts([\n        {\n          type: 'select',\n          name: 'chosenPackageManager',\n          message: promptQuestion,\n          choices: [installWithYarn, installWithNpm, skipInstallation],\n        },\n      ]);\n\n      removeMessage(`? ${promptQuestion} ${chosenPackageManager}`);\n\n      if (\n        chosenPackageManager === skipInstallation.value ||\n        !chosenPackageManager // e.g. when user presses Esc\n      ) {\n        loader.fail();\n\n        // Then we just print out the URL that the user can head to download the library\n        logManualInstallation({\n          healthcheck: 'ios-deploy',\n          url: 'https://github.com/ios-control/ios-deploy#readme',\n        });\n\n        return;\n      }\n\n      const shouldInstallWithYarn =\n        chosenPackageManager === installWithYarn.value;\n\n      return installLibrary({\n        installationCommand: shouldInstallWithYarn\n          ? installationWithYarn\n          : installationWithNpm,\n        loader,\n        packageManagerToUse: chosenPackageManager,\n      });\n    }\n\n    return installLibrary({\n      installationCommand,\n      packageManagerToUse: packageManager!.toLowerCase() as 'yarn' | 'npm',\n      loader,\n    });\n  },\n} as HealthCheckInterface;\n"]}