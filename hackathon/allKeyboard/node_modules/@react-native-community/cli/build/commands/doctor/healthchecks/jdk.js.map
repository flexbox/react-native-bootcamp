{"version":3,"sources":["../../../../src/commands/doctor/healthchecks/jdk.ts"],"names":["label","getDiagnostics","Languages","needsToBeFixed","version","Java","versionRange","versionRanges","JAVA","win32AutomaticFix","loader","installerUrl","installPath","process","env","LOCALAPPDATA","downloadUrl","component","text","jdkPath","succeed","e","fail","runAutomaticFix","logManualInstallation","healthcheck","url"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;;AACA;;AAGA;;AACA;;;;eAKe;AACbA,EAAAA,KAAK,EAAE,KADM;AAEbC,EAAAA,cAAc,EAAE,OAAO;AAACC,IAAAA;AAAD,GAAP,MAAwB;AACtCC,IAAAA,cAAc,EAAE,kDAA0B;AACxCC,MAAAA,OAAO,EACL,OAAOF,SAAS,CAACG,IAAjB,KAA0B,QAA1B,GACIH,SAAS,CAACG,IADd,GAEIH,SAAS,CAACG,IAAV,CAAeD,OAJmB;AAKxCE,MAAAA,YAAY,EAAEC,uBAAcC;AALY,KAA1B,CADsB;AAStCJ,IAAAA,OAAO,EACL,OAAOF,SAAS,CAACG,IAAjB,KAA0B,QAA1B,GACIH,SAAS,CAACG,IADd,GAEIH,SAAS,CAACG,IAAV,CAAeD,OAZiB;AAatCE,IAAAA,YAAY,EAAEC,uBAAcC;AAbU,GAAxB,CAFH;AAiBbC,EAAAA,iBAAiB,EAAE,OAAO;AAACC,IAAAA;AAAD,GAAP,KAAoB;AACrC,QAAI;AACF;AACA,YAAMC,YAAY,GAChB,kFADF;AAEA,YAAMC,WAAW,GAAGC,OAAO,CAACC,GAAR,CAAYC,YAAZ,IAA4B,EAAhD,CAJE,CAIkD;;AAEpD,YAAM,wCAAiB;AACrBL,QAAAA,MADqB;AAErBM,QAAAA,WAAW,EAAEL,YAFQ;AAGrBM,QAAAA,SAAS,EAAE,KAHU;AAIrBL,QAAAA;AAJqB,OAAjB,CAAN;AAOAF,MAAAA,MAAM,CAACQ,IAAP,GAAc,gCAAd;AAEA,YAAMC,OAAO,GAAG,kBAAKP,WAAL,EAAkB,YAAlB,CAAhB;AAEA,YAAM,0CAAe,WAAf,EAA4BO,OAA5B,CAAN;AACA,YAAM,6CAAkB,MAAlB,EAA0B,kBAAKA,OAAL,EAAc,KAAd,CAA1B,CAAN;AAEAT,MAAAA,MAAM,CAACU,OAAP,CACE,0EADF;AAGD,KAvBD,CAuBE,OAAOC,CAAP,EAAU;AACVX,MAAAA,MAAM,CAACY,IAAP,CAAYD,CAAZ;AACD;AACF,GA5CY;AA6CbE,EAAAA,eAAe,EAAE,OAAO;AAACC,IAAAA,qBAAD;AAAwBd,IAAAA;AAAxB,GAAP,KAA2C;AAC1DA,IAAAA,MAAM,CAACY,IAAP;AACAE,IAAAA,qBAAqB,CAAC;AACpBC,MAAAA,WAAW,EAAE,KADO;AAEpBC,MAAAA,GAAG,EAAE;AAFe,KAAD,CAArB;AAID;AAnDY,C","sourcesContent":["import {join} from 'path';\nimport versionRanges from '../versionRanges';\nimport {doesSoftwareNeedToBeFixed} from '../checkInstallation';\nimport {HealthCheckInterface} from '@react-native-community/cli-types';\n\nimport {downloadAndUnzip} from '../../../tools/downloadAndUnzip';\nimport {\n  setEnvironment,\n  updateEnvironment,\n} from '../../../tools/windows/environmentVariables';\n\nexport default {\n  label: 'JDK',\n  getDiagnostics: async ({Languages}) => ({\n    needsToBeFixed: doesSoftwareNeedToBeFixed({\n      version:\n        typeof Languages.Java === 'string'\n          ? Languages.Java\n          : Languages.Java.version,\n      versionRange: versionRanges.JAVA,\n    }),\n\n    version:\n      typeof Languages.Java === 'string'\n        ? Languages.Java\n        : Languages.Java.version,\n    versionRange: versionRanges.JAVA,\n  }),\n  win32AutomaticFix: async ({loader}) => {\n    try {\n      // Installing JDK 11 because later versions seem to cause issues with gradle at the moment\n      const installerUrl =\n        'https://download.java.net/java/GA/jdk11/9/GPL/openjdk-11.0.2_windows-x64_bin.zip';\n      const installPath = process.env.LOCALAPPDATA || ''; // The zip is in a folder `jdk-11.02` so it can be unzipped directly there\n\n      await downloadAndUnzip({\n        loader,\n        downloadUrl: installerUrl,\n        component: 'JDK',\n        installPath,\n      });\n\n      loader.text = 'Updating environment variables';\n\n      const jdkPath = join(installPath, 'jdk-11.0.2');\n\n      await setEnvironment('JAVA_HOME', jdkPath);\n      await updateEnvironment('PATH', join(jdkPath, 'bin'));\n\n      loader.succeed(\n        'JDK installed successfully. Please restart your shell to see the changes',\n      );\n    } catch (e) {\n      loader.fail(e);\n    }\n  },\n  runAutomaticFix: async ({logManualInstallation, loader}) => {\n    loader.fail();\n    logManualInstallation({\n      healthcheck: 'JDK',\n      url: 'https://openjdk.java.net/',\n    });\n  },\n} as HealthCheckInterface;\n"]}