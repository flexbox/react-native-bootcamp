{"version":3,"sources":["../../../src/commands/init/editTemplate.ts"],"names":["DEFAULT_TITLE_PLACEHOLDER","replaceNameInUTF8File","filePath","projectName","templateName","logger","debug","isPackageJson","path","basename","fileContent","fs","readFileSync","replacedFileContent","replace","RegExp","toLowerCase","writeFileSync","renameFile","oldName","newName","newFileName","join","dirname","renameSync","shouldRenameFile","nameToReplace","includes","shouldIgnoreFile","match","UNDERSCORED_DOTFILES","processDotfiles","dotfile","find","e","undefined","changePlaceholderInTemplate","placeholderName","placeholderTitle","projectTitle","process","cwd","reverse","forEach","statSync","isDirectory"],"mappings":"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","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport {logger} from '@react-native-community/cli-tools';\nimport walk from '../../tools/walk';\n\ninterface PlaceholderConfig {\n  projectName: string;\n  placeholderName: string;\n  placeholderTitle?: string;\n  projectTitle?: string;\n}\n\n/**\n  TODO: This is a default placeholder for title in react-native template.\n  We should get rid of this once custom templates adapt `placeholderTitle` in their configurations.\n*/\nconst DEFAULT_TITLE_PLACEHOLDER = 'Hello App Display Name';\n\nfunction replaceNameInUTF8File(\n  filePath: string,\n  projectName: string,\n  templateName: string,\n) {\n  logger.debug(`Replacing in ${filePath}`);\n  const isPackageJson = path.basename(filePath) === 'package.json';\n  const fileContent = fs.readFileSync(filePath, 'utf8');\n  const replacedFileContent = fileContent\n    .replace(new RegExp(templateName, 'g'), projectName)\n    .replace(\n      new RegExp(templateName.toLowerCase(), 'g'),\n      projectName.toLowerCase(),\n    );\n\n  if (fileContent !== replacedFileContent) {\n    fs.writeFileSync(filePath, replacedFileContent, 'utf8');\n  }\n\n  if (isPackageJson) {\n    fs.writeFileSync(\n      filePath,\n      fileContent.replace(templateName, projectName.toLowerCase()),\n      'utf8',\n    );\n  }\n}\n\nfunction renameFile(filePath: string, oldName: string, newName: string) {\n  const newFileName = path.join(\n    path.dirname(filePath),\n    path.basename(filePath).replace(new RegExp(oldName, 'g'), newName),\n  );\n\n  logger.debug(`Renaming ${filePath} -> file:${newFileName}`);\n\n  fs.renameSync(filePath, newFileName);\n}\n\nfunction shouldRenameFile(filePath: string, nameToReplace: string) {\n  return path.basename(filePath).includes(nameToReplace);\n}\n\nfunction shouldIgnoreFile(filePath: string) {\n  return filePath.match(/node_modules|yarn.lock|package-lock.json/g);\n}\n\nconst UNDERSCORED_DOTFILES = [\n  'buckconfig',\n  'eslintrc.js',\n  'flowconfig',\n  'gitattributes',\n  'gitignore',\n  'prettierrc.js',\n  'watchmanconfig',\n  'editorconfig',\n];\n\nfunction processDotfiles(filePath: string) {\n  const dotfile = UNDERSCORED_DOTFILES.find((e) => filePath.includes(`_${e}`));\n\n  if (dotfile === undefined) {\n    return;\n  }\n\n  renameFile(filePath, `_${dotfile}`, `.${dotfile}`);\n}\n\nexport function changePlaceholderInTemplate({\n  projectName,\n  placeholderName,\n  placeholderTitle = DEFAULT_TITLE_PLACEHOLDER,\n  projectTitle = projectName,\n}: PlaceholderConfig) {\n  logger.debug(`Changing ${placeholderName} for ${projectName} in template`);\n\n  walk(process.cwd())\n    .reverse()\n    .forEach((filePath: string) => {\n      if (shouldIgnoreFile(filePath)) {\n        return;\n      }\n      if (!fs.statSync(filePath).isDirectory()) {\n        replaceNameInUTF8File(filePath, projectName, placeholderName);\n        replaceNameInUTF8File(filePath, projectTitle, placeholderTitle);\n      }\n      if (shouldRenameFile(filePath, placeholderName)) {\n        renameFile(filePath, placeholderName, projectName);\n      }\n      if (shouldRenameFile(filePath, placeholderName.toLowerCase())) {\n        renameFile(\n          filePath,\n          placeholderName.toLowerCase(),\n          projectName.toLowerCase(),\n        );\n      }\n\n      processDotfiles(filePath);\n    });\n}\n"]}