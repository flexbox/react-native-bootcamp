# React Native Data Management

## What you will learn

- Fetch data over the network from the Star Wars API
- Display status and datas with `useQuery`
- Use an advanced React Pattern: [Context API](https://reactjs.org/docs/context.html)

## ðŸ‘¾ Before we start the exercise

- [ ] You should have a look at [the SWAPI documentation](https://swapi.dev/documentation#starships)
- [ ] We are going to install and use `react-query`

Here's how it works:

1. Write your data fetching functions
1. Wrap them in a named query
1. `react-query` handles caching, deduping, re-fetching, and loading states

```typescript
async function fetchData(itemId) {
  const res = await fetch(`https://example.com/api/${itemId}`)
  const json = await res.json()
  return json
}

function Component({ itemId }) {
  const { isLoading, data } = useQuery(["fetchData", itemId], fetchData)

  if (isLoading) {
    return <Text>Loadingâ€¦</Text>
  } else {
    return <DoStuffWithData data={data} />
  }
}
```

Back to the example we had before.

## ðŸ‘¨â€ðŸš€ Exercise 1

![Starships list](https://raw.githubusercontent.com/reactgraphqlacademy/twitter-clone-native/master/src/exercice/05/starships.png)

- [`QueryClientProvider` documentation](https://react-query.tanstack.com/reference/QueryClientProvider#_top)
- [`react-query` documentation](https://react-query.tanstack.com/docs/guides/queries)

- [ ] Install the library with `yarn add react-query`
- [ ] Add a `QueryClientProvider` and wrap the application.

- [ ] Create a new file on `./lib/fetchAsync.ts` and copy this

```javascript
// ./lib/fetchAsync.ts

export default async function fetchAsync(...args: any) {
  const res = await fetch(...args);
  return await res.json();
}
```

This utility library will help-us to return asynchronous data

- [ ] Use `useQuery` hooks to query datas

  - with a **unique key for the query**
  - with a function that returns a promise `() => fetchAsync(`https://swapi.dev/api/starships/`

- [ ] Use the `StarShipCard` to display the datas

## ðŸ‘½ Bonus

- [ ] go even further and wrap queries into custom hooks:

```typescript
// ./hooks/useStarships.ts

async function fetchData() {
  const res = await fetch(`https://swapi.dev/api/starships/`)
  const json = await res.json()
  return json
}

export function useStarships() {
  return useQuery(["starships"], fetchData)
}
```

Now you can put `useStarships()` anywhere in your codebase and React Query handles the rest.

- [ ] Watch the talk: [Custom Hooks in React: The Ultimate UI Abstraction Layer](https://www.youtube.com/watch?v=J-g9ZJha8FE) from Tanner Linsley
