# Design System in React Native with Storybook

<img src="https://raw.githubusercontent.com/flexbox/react-native-workshop/main/challenges/assets/storybook.png" width="100px" height="100px" alt="Storybook Logo" />

## üì° What you will learn

- Setup Storybook v10 with React Native.
- Writing `.stories` to debug your application with isolated components.

## üëæ Before we start the exercise

- You can have a look at the [`storybook-for-react-native` documentation](https://github.com/storybookjs/react-native#storybook-for-react-native).

## üë®‚ÄçüöÄ Exercise 4

- [ ] Setup Storybook

```console
npm create storybook@latest
```

**üî≠ Hint:** Read the prompt, the setup is NOT 100% automated.

To run Storybook, you will need to:

First create metro config file if you don't have it yet.

```console
npx expo customize metro.config.js
```

Then wrap your config with the `withStorybook` function and add the `enabled` option:

```js
// metro.config.js
const { getDefaultConfig } = require('expo/metro-config');
const { withStorybook } = require('@storybook/react-native/metro/withStorybook');

const config = getDefaultConfig(__dirname);

module.exports = withStorybook(config, {
  enabled: process.env.EXPO_PUBLIC_STORYBOOK_ENABLED === 'true',
});
```

For a more detailed guide go to:

https://github.com/storybookjs/react-native#existing-project

### Render Storybook

![Change App.tsx for Storybook in React Native](https://raw.githubusercontent.com/flexbox/react-native-workshop/main/challenges/ecosystem/storybook-booting.png)

- [ ] Change the entry point of your application to conditionally load Storybook based on the environment variable:

```tsx
// App.tsx
import { StatusBar } from 'expo-status-bar';
import { StyleSheet, Text, View } from 'react-native';

function App() {
  return (
    <View style={styles.container}>
      <Text>Open up App.tsx to start working on your app!</Text>
      <StatusBar style="auto" />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#fff',
    alignItems: 'center',
    justifyContent: 'center',
  },
});

let AppEntryPoint = App;

if (process.env.EXPO_PUBLIC_STORYBOOK_ENABLED === 'true') {
  AppEntryPoint = require('./.rnstorybook').default;
}

export default AppEntryPoint;
```

- [ ] Update your `package.json` to add the storybook command:

```diff
  "scripts": {
    "start": "expo start",
    "android": "expo start --android",
    "ios": "expo start --ios",
    "web": "expo start --web",
++  "storybook": "EXPO_PUBLIC_STORYBOOK_ENABLED=true expo start",
    "storybook-generate": "sb-rn-get-stories"
  },
```

- [ ] Run Storybook with `npm run storybook`, you should have the Storybook displayed like this:

<img src="https://raw.githubusercontent.com/flexbox/react-native-workshop/main/challenges/ecosystem/storybook-first-launch.gif" width="50%" height="50%" alt="Storybook React Native first launch" />

### Adding your own stories

Right now, storybook display components created for testing purposes. We want to add our own components and follow the **principle of colocation**.

> Place code as close to where it's relevant as possible

- [ ] Delete generated example stories:

```console
rm -rf .rnstorybook/stories/
```

- [ ] Update `.rnstorybook/main.ts` file to load stories from our components folder:

```diff
// .rnstorybook/main.ts
import type { StorybookConfig } from '@storybook/react-native';

const main: StorybookConfig = {
--  stories: ['./stories/**/*.stories.?(ts|tsx|js|jsx)'],
++  stories: ['../src/components/**/*.stories.?(ts|tsx|js|jsx)'],
  addons: [],
};

export default main;
```

- [ ] Create a new file `./src/components/Text.stories.tsx`:

```javascript
// ./src/components/Text.stories.tsx

import React from "react";
import { View } from "react-native";
import { Text } from "react-native-paper";

export default {
  title: "Text",
};

export const Default = () => (
  <View style={{ padding: 16, justifyContent: "space-between", flex: 1 }}>
    <Text variant="displayLarge">Display Large</Text>
    <Text variant="displayMedium">Display Medium</Text>
    <Text variant="displaySmall">Display small</Text>

    <Text variant="headlineLarge">Headline Large</Text>
    <Text variant="headlineMedium">Headline Medium</Text>
    <Text variant="headlineSmall">Headline Small</Text>

    <Text variant="titleLarge">Title Large</Text>
    <Text variant="titleMedium">Title Medium</Text>
    <Text variant="titleSmall">Title Small</Text>

    <Text variant="bodyLarge">Body Large</Text>
    <Text variant="bodyMedium">Body Medium</Text>
    <Text variant="bodySmall">Body Small</Text>
  </View>
);

Default.story = {
  name: "Default",
};
```

- [ ] Create a new `Button.stories.tsx` and add all types of buttons when `mode` is `'text' | 'outlined' | 'contained'`

```javascript
// ./src/components/Button.stories.tsx

import React from "react";
import { View } from "react-native";
import { Button } from "react-native-paper";

export default {
  title: "Button",
};

export const Default = () => (
  <View style={{ padding: 16, justifyContent: "space-between", flex: 1 }}>
    {/* import buttons from https://callstack.github.io/react-native-paper/docs/components/Button/ */}
  </View>
);

Default.story = {
  name: "Default",
};
```

- [ ] Create a `Card.stories.tsx`

## üëΩ Bonus

- [ ] You can [watch me live coding with Dany](https://www.youtube.com/watch?v=QgYPgDxJRkU) the maintainer of Storybook React Native.
